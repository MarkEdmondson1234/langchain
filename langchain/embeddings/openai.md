This code defines a function for embedding text using OpenAI's embedding models. The `embed_with_retry` function uses the Tenacity library to retry the embedding call if there is an error. The code also defines a helper function `_create_retry_decorator` that creates a retry decorator for the `embed_with_retry` function. The code imports necessary packages and defines parameters for the retry decorator. The `embed_with_retry` function takes an `OpenAIEmbeddings` object and keyword arguments as input and returns the resulting embeddings.

This code defines a wrapper class `OpenAIEmbeddings` around OpenAI's embedding models. The class includes methods for embedding text using OpenAI's remote hardware. The code imports necessary packages and defines parameters for the embedding request. The `embed_with_retry` function uses the Tenacity library to retry the embedding call if there is an error. The `OpenAIEmbeddings` class also includes a root validator that validates that the necessary environment variables and packages exist. The class can be used with Microsoft Azure endpoints by setting the corresponding environment variables.

The code defines a wrapper class `OpenAIEmbeddings` around OpenAI's embedding models, which includes methods for embedding text using OpenAI's remote hardware. The class can be used with Microsoft Azure endpoints by setting the corresponding environment variables. The code also imports necessary packages and defines parameters for the embedding request. The `embed_with_retry` function uses the Tenacity library to retry the embedding call if there is an error. The `_get_len_safe_embeddings` function is used to safely embed long texts. It uses the `tiktoken` package to encode the text into tokens, and then batches the tokens for embedding. The resulting embeddings are then averaged and normalized. The code includes a root validator that validates that the necessary environment variables and packages exist.

The code defines a wrapper class `OpenAIEmbeddings` around OpenAI's embedding models, which includes methods for embedding text using OpenAI's remote hardware. The class can be used with Microsoft Azure endpoints by setting the corresponding environment variables. The code also imports necessary packages and defines parameters for the embedding request. The `embed_with_retry` function uses the Tenacity library to retry the embedding call if there is an error. The `_get_len_safe_embeddings` function is used to safely embed long texts. It uses the `tiktoken` package to encode the text into tokens, and then batches the tokens for embedding. The resulting embeddings are then averaged and normalized. The code includes a root validator that validates that the necessary environment variables and packages exist. The `embed_documents` function calls out to OpenAI's embedding endpoint for embedding search docs, and the `embed_query` function calls out to OpenAI's embedding endpoint for embedding query text.

